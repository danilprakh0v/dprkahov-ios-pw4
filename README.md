# WishMaker — iOS-приложение для списка желаний и планирования событий

## Описание проекта по ДЗ №4

В рамках домашнего задания №4 функционал был существенно расширен: добавлена интеграция с системным календарем, возможность создавать события, привязанные к желаниям, и управлять ими через удобный интерфейс.

Система реализует все требования и предоставляет следующие возможности:
- **Планирование событий:** Создание событий с названием, описанием, датой начала и окончания.
- **Интеграция с Calendar API:** Автоматическое сохранение созданных событий в системный календарь iOS (используется `EventKit`).
- **Группировка по датам:** События в интерфейсе автоматически сортируются и разбиваются на секции по дням.
- **Динамическая смена цветовой темы:** Изменение акцентного цвета всего приложения (включая новые экраны).
- **Управление данными:** Полный цикл CRUD (Create, Read, Update, Delete) для желаний и событий.
- **Шеринг:** Возможность поделиться желанием или событием через системный `UIActivityViewController`.

---

## Технические улучшения и Рефакторинг

В этой итерации проекта был проведен значительный рефакторинг кода для соответствия современным стандартам разработки под iOS - (iOS 14+):

### 1. Современная обработка действий (`UIAction`)
Отказ от устаревшего паттерна Target-Action с использованием `@objc` селекторов (`addTarget`) везде, где это возможно.
- **Было:** Разделение логики настройки кнопки и метода-обработчика.
- **Стало:** Использование `UIAction` и замыканий (closures) прямо при инициализации элементов. Это сделало код более компактным, безопасным (type-safe) и локализованным.

### 2. Архитектурные паттерны
- **Singleton (Одиночка):** Реализован класс `CalendarManager`, который инкапсулирует всю логику работы с `EventKit`. Это позволяет обращаться к календарю из любой точки приложения через `CalendarManager.shared`.
- **Delegation & Closures:** Активное использование замыканий для передачи данных между ячейками и контроллерами - (например, обработка нажатий кнопок удаления и шеринга внутри `WishEventCell`).

### 3. Работа с данными
- **Codable:** Модель данных `WishEvent` подписана на протокол `Codable`, что позволяет легко сериализовать сложные структуры данных в JSON для сохранения в `UserDefaults`.
- **Protocol-Oriented Programming:** Введен протокол `CalendarManaging` для абстракции логики календаря - (полезно для возможного тестирования в будущем).

### 4. UI и Анимации
- **CollectionView:** Для экрана календаря использован `UICollectionView` вместо `UITableView` для большей гибкости верстки.
- **Custom Animations:** Реализована сложная анимация удаления ячеек (`performBatchUpdates`), при которой ячейка сначала визуально уменьшается и исчезает, и только затем удаляется секция или строка.

---

## Архитектура: Расширенный MVC

Проект по-прежнему базируется на паттерне **Model-View-Controller (MVC)**, но структура стала сложнее и насыщеннее.

### Model (Модель)
Слой данных теперь включает не только строки, но и сложные структуры.
- **Сущности:** `WishEvent` (структура события с UUID, датами и описанием).
- **Менеджеры:** `CalendarManager` (работа с системным API), логика сохранения массивов через `JSONEncoder`/`JSONDecoder`.

### View (Представление)
Отвечает за отображение данных.
- **Новые элементы:** `WishEventCell` (ячейка события), `EventSectionHeaderView` (заголовки дат), `CustomSlider` (обновленный слайдер).
- **Верстка:** Полностью кодовая (`Auto Layout`), активное использование `UIStackView` для адаптивного интерфейса.

### Controller (Контроллер)
Связующее звено.
- `WishCalendarViewController`: Управляет коллекцией событий, их группировкой по дням и навигацией.
- `WishEventCreationViewController`: Экран создания/редактирования события. Реализует валидацию введенных данных.
- `WishMakerViewController` & `WishStoringViewController`: Обновлены для поддержки новой навигации и стилей.

---

## Clean Code

В соответствии с требованиями, код поддерживается в чистоте:
- **Constants Enum:** В каждом классе используется приватный enum `Constants` для хранения всех "магических чисел", строк, шрифтов и настроек layout'а.
- **Access Control:** Строгое использование модификаторов доступа (`private`, `final`) для инкапсуляции и оптимизации.
- **Memory Management:** Корректное использование `[weak self]` в замыканиях для предотвращения утечек памяти (Retain Cycles).

---

## Инструкция по запуску

1. Откройте файл `dprakhovPW4.xcodeproj` в Xcode.
2. Выберите симулятор (рекомендуется **iPhone 16/17 Pro** с iOS 18+).
3. Нажмите **Run** (⌘R).
4. **Важно:** При первом попытке сохранить событие приложение запросит доступ к Календарю. Необходимо нажать "Разрешить" (Allow Full Access или Allow Write Only), чтобы функционал работал корректно.

---

### Прахов Данил, БПИ246
**Дата обновления:** 20.11.2025
